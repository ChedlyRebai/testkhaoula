{% extends "admin/base_admin.html.twig" %}

{% block title %}Admin Posts{% endblock %}

{% block body %}

<div class="d-sm-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 mb-0 text-gray-800">Posts Administrateur</h1>
  <a href="{{ path('app_admin_post_create') }}" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
    <i class="fas fa-plus fa-sm text-white-50"></i> Créer un nouveau post
  </a>
</div>

{% if app.flashes %}
  {% for label, messages in app.flashes %}
    <div class="alert alert-{{ label == 'success' ? 'success' : 'danger' }} alert-dismissible fade show" role="alert">
      {% for message in messages %}
        {{ message }}
      {% endfor %}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}

<div class="card shadow mb-4">
  <div class="card-header py-3">
    <h6 class="m-0 font-weight-bold text-primary">
      <i class="fas fa-file"></i> Mes Posts ({{ posts|length }})
    </h6>
  </div>
  <div class="card-body">

    {% if posts|length > 0 %}
      <div class="table-responsive">
        <table class="table table-bordered table-hover" width="100%" cellspacing="0">
          <thead class="bg-primary text-white">
            <tr>
              <th>ID</th>
              <th>Titre</th>
              <th>Contenu</th>
              <th>Créé le</th>
              <th>Vues</th>
              <th>Commentaires</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for post in posts %}
              <tr>
                <td>{{ post.id }}</td>
                <td><strong>{{ post.title }}</strong></td>
                <td>
                  <small>{{ post.content|slice(0, 50)|striptags }}{% if post.content|length > 50 %}...{% endif %}</small>
                </td>
                <td><small>{{ post.createdAt|date('d/m/Y H:i') }}</small></td>
                <td><span class="badge badge-info">{{ post.views }}</span></td>
                <td><span class="badge badge-success">{{ post.commentaires|length }}</span></td>
                <td style="display:flex;align-items:center;gap:6px;">
                  <a href="{{ path('app_admin_post_view', {id: post.id}) }}" class="btn btn-sm btn-info" target="_blank" title="Voir">
                    <i class="fas fa-eye"></i>
                  </a>
                  <a href="{{ path('app_admin_post_edit', {id: post.id}) }}" class="btn btn-sm btn-warning" title="Éditer">
                    <i class="fas fa-edit"></i>
                  </a>
                  <form method="POST" action="{{ path('app_admin_post_delete', {id: post.id}) }}" style="margin:0;display:inline;">
                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Êtes-vous sûr?');" title="Supprimer">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-info">
        Vous n'avez pas encore créé de posts. <a href="{{ path('app_admin_post_create') }}">Créer un post</a>
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}
